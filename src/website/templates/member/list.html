{% extends "layout.html" %}
{% block title %}
HOME
{% endblock %}
{% block link %}
{{super() }}
{% endblock %}

{% block body %}
{{ super() }}

<div class="container">
  <h1>Member Manage</h1>
  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th class="text-center">No.</th>
          <th>ID</th>
          <th>Created Date</th>
          <th class="text-center">Encrypted</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for member in members %}
        <tr>
          <td class="text-center">{{ loop.index }}</td>
          <td>{{ member.userid }}</td>
          <td>{{ member.created.strftime("%Y-%m-%d %H:%M:%S") }}</td>
          <td class="text-center">{% if member.password | length > 20 %}YES{% else %}NO{% endif %}</td>
          <td>
            <div class="float-right">
              <a href="#" class="btn btn-primary btn-sm">Modify</a>
              <a href="#" class="btn btn-danger btn-sm" onclick="remove('{{ member.userid }}');">Delete</a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block footer %}
{{ super() }}
<script>
  function remove(userid) {
    $.ajax({
      url: `/member/${userid}`,
      method : 'delete',
      success : function(data){
        var json = JSON.parse(data);
        alert(json.status);

        $(".table > tbody > tr").each(function(){
          var tdText = $(this).find("td:eq(1)").text();
          if(userid == tdText){
            $(this).remove();
          }
        })

        $(".table > tbody > tr").each(function(idx){
          $(this).find("td:eq(0)").html(idx+1);
          idx++;
        })
      }
    })
  }
</script>
{% endblock %}